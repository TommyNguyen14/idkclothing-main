{{ 'component-age-verification.css' | asset_url | stylesheet_tag }}

<div id="age-verification-modal" class="age-verification-modal" style="display: none;">
  <div class="age-verification-overlay">
    <div class="age-verification-content">
      <div class="age-verification-header">
        <h2>{{ section.settings.heading | default: 'Confirm your age' }}</h2>
      </div>
      
      <div class="age-verification-body">
        <p>{{ section.settings.text | default: 'Are you 18 years old or older?' }}</p>
      </div>
      
      <div class="age-verification-actions">
        <button id="age-verification-no" class="btn btn-secondary">
          {{ section.settings.no_button_text | default: "No I'm not" }}
        </button>
        <button id="age-verification-yes" class="btn btn-primary">
          {{ section.settings.yes_button_text | default: "Yes I am" }}
        </button>
      </div>
    </div>
  </div>
</div>

<div id="age-verification-underage" class="age-verification-modal" style="display: none;">
  <div class="age-verification-overlay">
    <div class="age-verification-content">
      <div class="age-verification-header">
        <h2>{{ section.settings.underage_heading | default: 'Come back when you\'re older' }}</h2>
      </div>
      
      <div class="age-verification-body">
        <p>{{ section.settings.underage_text | default: 'Sorry, the content of this store can\'t be seen by a younger audience. Come back when you\'re older.' }}</p>
      </div>
      
      <div class="age-verification-actions">
        <button id="age-verification-retry" class="btn btn-primary">
          {{ section.settings.retry_button_text | default: "Oops, I entered incorrectly" }}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('age-verification-modal');
    const underageModal = document.getElementById('age-verification-underage');
    const yesButton = document.getElementById('age-verification-yes');
    const noButton = document.getElementById('age-verification-no');
    const retryButton = document.getElementById('age-verification-retry');
    
    // Check if user has already verified their age
    const ageVerified = localStorage.getItem('age-verified');
    
    if (!ageVerified) {
      // Show the age verification modal after a short delay
      setTimeout(() => {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }, 1000);
    }
    
    // Handle Yes button click
    yesButton.addEventListener('click', function() {
      localStorage.setItem('age-verified', 'true');
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });
    
    // Handle No button click
    noButton.addEventListener('click', function() {
      modal.style.display = 'none';
      underageModal.style.display = 'block';
    });
    
    // Handle retry button click
    retryButton.addEventListener('click', function() {
      underageModal.style.display = 'none';
      modal.style.display = 'block';
    });
    
    // Close modal when clicking outside
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        // Don't allow closing without making a choice
        return false;
      }
    });
    
    underageModal.addEventListener('click', function(e) {
      if (e.target === underageModal) {
        // Don't allow closing without making a choice
        return false;
      }
    });
  });
</script>

{% schema %}
{
  "name": "Age Verification",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Age Verification Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "default": "Confirm your age",
      "label": "Heading"
    },
    {
      "type": "textarea",
      "id": "text",
      "default": "Are you 18 years old or older?",
      "label": "Verification text"
    },
    {
      "type": "text",
      "id": "yes_button_text",
      "default": "Yes I am",
      "label": "Yes button text"
    },
    {
      "type": "text",
      "id": "no_button_text",
      "default": "No I'm not",
      "label": "No button text"
    },
    {
      "type": "header",
      "content": "Underage Message Settings"
    },
    {
      "type": "text",
      "id": "underage_heading",
      "default": "Come back when you're older",
      "label": "Underage heading"
    },
    {
      "type": "textarea",
      "id": "underage_text",
      "default": "Sorry, the content of this store can't be seen by a younger audience. Come back when you're older.",
      "label": "Underage text"
    },
    {
      "type": "text",
      "id": "retry_button_text",
      "default": "Oops, I entered incorrectly",
      "label": "Retry button text"
    },
    {
      "type": "header",
      "content": "Section Visibility"
    },
    {
      "type": "checkbox",
      "id": "enable_age_verification",
      "default": true,
      "label": "Enable age verification"
    }
  ],
  "presets": [
    {
      "name": "Age Verification"
    }
  ]
}
{% endschema %}
